<!-- â•â• HERO â•â• -->
<div class="page-hero">
  <div class="hero-inner">
    <span class="eyebrow">EncuÃ©ntranos</span>
    <h1 class="hero-title">Nuestra <span class="yl">FÃ¡brica</span></h1>
    <p class="hero-sub">VisÃ­tanos en nuestro showroom en Surquillo, Lima y conoce toda la colecciÃ³n</p>
    <div class="hero-stats">
      <div class="hstat"><span class="hstat-n">1</span><span class="hstat-l">FÃ¡brica & Showroom</span></div>
      <div class="hstat"><span class="hstat-n">41</span><span class="hstat-l">AÃ±os de experiencia</span></div>
      <div class="hstat"><span class="hstat-n">ğŸŒ</span><span class="hstat-l">Toda LatinoamÃ©rica</span></div>
    </div>
  </div>
</div>

<div class="stripe"><span></span><span></span><span></span><span></span></div>

<!-- â•â• LAYOUT â•â• -->
<div class="tiendas-layout">

  <!-- LISTA -->
  <div class="tiendas-list">
    <p class="list-count"><strong>{{ tiendaFiltradas().length }}</strong> tienda{{ tiendaFiltradas().length !== 1 ? 's' : '' }} encontrada{{ tiendaFiltradas().length !== 1 ? 's' : '' }}</p>

    @if (tiendaFiltradas().length === 0) {
      <div class="empty-list"><span>ğŸ”</span><p>No hay tiendas con esos filtros</p></div>
    }

    @for (t of tiendaFiltradas(); track t.id) {
      <div class="tienda-card" [class.active]="tiendaActiva()?.id === t.id" [class.destacada]="t.destacada" (click)="seleccionar(t)">
        <div class="card-badges">
          @if (t.destacada) { <span class="badge badge-main">Sede Principal</span> }
          <span class="badge" [class.badge-propia]="t.tipo==='propia'" [class.badge-dist]="t.tipo==='distribuidor'">
            {{ t.tipo === 'propia' ? 'Tienda Propia' : 'Distribuidor' }}
          </span>
        </div>
        <h3 class="card-nombre">{{ t.nombre }}</h3>
        <div class="card-row"><span class="card-icon">ğŸ“</span><span class="card-val">{{ t.direccion }}, {{ t.ciudad }}</span></div>
        <div class="card-row"><span class="card-icon">ğŸ•</span><span class="card-val">{{ t.horario }}</span></div>
        @if (t.telefono) {
          <div class="card-row"><span class="card-icon">ğŸ“</span><span class="card-val">{{ t.telefono }}</span></div>
        }
        <div class="card-actions">
          <a [href]="mapUrl(t)" target="_blank" rel="noopener" class="btn-map" (click)="$event.stopPropagation()">ğŸ—ºï¸ CÃ³mo llegar</a>
          <a [href]="(waBase + waTexto(t)) | sanitizeUrl" target="_blank" rel="noopener" class="btn-wa-sm" (click)="$event.stopPropagation()">
            <svg viewBox="0 0 24 24"><path [attr.d]="waIcon"/></svg> WhatsApp
          </a>
        </div>
      </div>
    }
  </div>

  <!-- MAPA PANEL -->
  <div class="mapa-panel">
    @if (tiendaActiva()) {
      <div class="mapa-wrap">
        <!-- Imagen estÃ¡tica de Geoapify â€” clickeable para abrir Google Maps -->
        <a [href]="mapUrl(tiendaActiva()!)" target="_blank" rel="noopener" style="display:block;width:100%;height:100%;position:relative;">
          <img
            [src]="mapaImagenUrl(tiendaActiva()!)"
            [alt]="'Mapa de ' + tiendaActiva()!.nombre"
            style="object-fit:cover;width:100%;height:100%;display:block;"
          />
          <div style="position:absolute;bottom:16px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.65);color:#fff;padding:8px 18px;border-radius:20px;font-size:13px;white-space:nowrap;pointer-events:none;">
            ğŸ—ºï¸ Clic para abrir en Google Maps
          </div>
        </a>

        <div class="mapa-overlay-card">
          <div class="moc-left">
            <span class="moc-dept">{{ tiendaActiva()!.departamento }}</span>
            <strong class="moc-nombre">{{ tiendaActiva()!.nombre }}</strong>
            <span class="moc-dir">{{ tiendaActiva()!.direccion }}</span>
          </div>
          <a [href]="mapUrl(tiendaActiva()!)" target="_blank" rel="noopener" class="moc-btn">Abrir en Maps â†—</a>
        </div>
      </div>

      <div class="detalle-card">
        <div class="detalle-header" [class.destacada]="tiendaActiva()!.destacada">
          <div>
            <span class="detalle-dept">{{ tiendaActiva()!.departamento }}</span>
            <h2 class="detalle-nombre">{{ tiendaActiva()!.nombre }}</h2>
          </div>
          @if (tiendaActiva()!.destacada) { <span class="badge badge-main">â­ Sede Principal</span> }
        </div>
        <div class="detalle-grid">
          <div class="detalle-item"><span class="di-label">ğŸ“ DirecciÃ³n</span><span class="di-val">{{ tiendaActiva()!.direccion }}, {{ tiendaActiva()!.ciudad }}</span></div>
          <div class="detalle-item"><span class="di-label">ğŸ• Horario</span><span class="di-val">{{ tiendaActiva()!.horario }}</span></div>
          @if (tiendaActiva()!.telefono) {
            <div class="detalle-item"><span class="di-label">ğŸ“ TelÃ©fono</span><span class="di-val">{{ tiendaActiva()!.telefono }}</span></div>
          }
          <div class="detalle-item"><span class="di-label">ğŸª Tipo</span><span class="di-val">{{ tiendaActiva()!.tipo === 'propia' ? 'Tienda Propia Piolito' : 'Distribuidor Autorizado' }}</span></div>
        </div>
        <div class="detalle-actions">
          <a [href]="mapUrl(tiendaActiva()!)" target="_blank" rel="noopener" class="btn-map-lg">ğŸ—ºï¸ Abrir en Google Maps</a>
          <a [href]="(waBase + waTexto(tiendaActiva()!)) | sanitizeUrl" target="_blank" rel="noopener" class="btn-wa-lg">
            <svg viewBox="0 0 24 24"><path [attr.d]="waIcon"/></svg> Consultar por WhatsApp
          </a>
        </div>
      </div>
    }
  </div>
</div>

<!-- â•â• ASÃ NACE UN PIOLITO â•â• -->
<section class="proceso-section">

  <div class="proceso-header">
    <span class="proceso-eyebrow">Nuestra fÃ¡brica</span>
    <h2 class="proceso-title">AsÃ­ nace un <span class="yl">Piolito</span></h2>
    <p class="proceso-sub">Cada par pasa por 8 etapas artesanales, con cuero legÃ­timo y manos peruanas.</p>
  </div>

  <div class="pnace-layout">

    <!-- COLUMNA IZQUIERDA: STACK DE VIDEOS -->
    <div class="pnace-stack">
      @for (paso of pasos; track paso.num; let i = $index) {
        <div class="pstack-card"
          [attr.data-pos]="i - pasoActivo"
          (click)="i !== pasoActivo ? irAPaso(i) : null">
          <video
            class="pstack-video"
            [src]="paso.video"
            muted playsinline loop
            [autoplay]="i === pasoActivo"
          ></video>
          <div class="pstack-overlay"></div>
          <div class="pstack-num">{{ paso.num }}</div>
        </div>
      }
    </div>

    <!-- COLUMNA DERECHA: INFO -->
    <div class="pnace-info">
      <!-- Barras stories -->
      <div class="pnace-bars">
        @for (paso of pasos; track paso.num; let i = $index) {
          <div class="pnbar" [class.done]="i < pasoActivo" (click)="irAPaso(i)">
            <div class="pnbar-fill" [style.width]="i === pasoActivo ? progreso + '%' : (i < pasoActivo ? '100%' : '0%')"></div>
          </div>
        }
      </div>

      <!-- Paso actual -->
      <div class="pnace-paso-info">
        <span class="pnace-icon">{{ pasos[pasoActivo].icon }}</span>
        <div>
          <span class="pnace-step-label">Paso {{ pasoActivo + 1 }} de 8</span>
          <h3 class="pnace-step-title">{{ pasos[pasoActivo].nombre }}</h3>
        </div>
      </div>

      <!-- DescripciÃ³n -->
      <p class="pnace-desc">{{ pasos[pasoActivo].desc }}</p>

      <!-- Lista de pasos -->
      <div class="pnace-list">
        @for (paso of pasos; track paso.num; let i = $index) {
          <button class="pnace-item" [class.active]="i === pasoActivo" [class.done]="i < pasoActivo" (click)="irAPaso(i)">
            <span class="pni-num">{{ paso.num }}</span>
            <span class="pni-nombre">{{ paso.nombre }}</span>
            @if (i < pasoActivo) { <span class="pni-check">âœ“</span> }
          </button>
        }
      </div>

      <!-- Botones nav -->
      <div class="pnace-nav">
        <button class="pnace-btn" (click)="irAPaso((pasoActivo - 1 + 8) % 8)">&#8249;</button>
        <button class="pnace-btn pnace-btn-next" (click)="siguientePaso()">Siguiente paso &#8250;</button>
      </div>
    </div>

  </div>
</section>


<a [href]="(waBase + 'Hola!%20Quisiera%20saber%20d%C3%B3nde%20encontrar%20calzado%20Piolito') | sanitizeUrl" class="wa-float" target="_blank" rel="noopener">
  <svg viewBox="0 0 24 24"><path [attr.d]="waIcon"/></svg>
</a>