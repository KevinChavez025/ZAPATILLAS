<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE HEADER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page-hero">
  <div class="page-hero-inner">
    <span class="page-eyebrow">üê£ Cat√°logo Completo</span>
    <h1 class="page-title">Nuestros <span class="yl">Modelos</span></h1>
    <p class="page-sub">Cuero leg√≠timo ¬∑ Dise√±o ortop√©dico ¬∑ Hecho en Per√∫</p>
  </div>
  <div class="search-wrap">
    <span class="search-icon">üîç</span>
    <input
      type="text"
      class="search-input"
      placeholder="Buscar por c√≥digo o material..."
      [value]="busqueda()"
      (input)="busqueda.set($any($event.target).value)"
    />
    @if (busqueda()) {
      <button class="search-clear" (click)="busqueda.set('')">‚úï</button>
    }
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LAYOUT: sidebar + grid ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="catalog-layout">

  <!-- ‚îÄ‚îÄ SIDEBAR FILTROS ‚îÄ‚îÄ -->
  <aside class="sidebar">

    <!-- L√≠nea -->
    <div class="filter-group">
      <h3 class="filter-title">L√≠nea</h3>
      <div class="etapa-list">
        @for (lin of lineas; track lin.key) {
          <button
            class="etapa-btn"
            [class.active]="filtroLinea() === lin.key"
            [style.--tab-color]="lin.color"
            (click)="setLinea(lin.key)"
          >{{ lin.label }}</button>
        }
      </div>
    </div>

    <!-- Subcategor√≠a (solo si hay l√≠nea seleccionada) -->
    @if (subcategoriasDisponibles().length > 0) {
      <div class="filter-group">
        <h3 class="filter-title">Subcategor√≠a</h3>
        <div class="etapa-list">
          <button
            class="etapa-btn"
            [class.active]="filtroSubcat() === 'todas'"
            (click)="setSubcat('todas')"
          >Todas</button>
          @for (s of subcategoriasDisponibles(); track s.key) {
            <button
              class="etapa-btn"
              [class.active]="filtroSubcat() === s.key"
              (click)="setSubcat(s.key)"
            >{{ s.label }}</button>
          }
        </div>
      </div>
    }

    <!-- G√©nero (solo para Tilin, Escolar y Todos) -->
    @if (filtroLinea() === 'todos' || filtroLinea() === 'tilin' || filtroLinea() === 'escolar') {
      <div class="filter-group">
        <h3 class="filter-title">G√©nero</h3>
        <div class="genero-btns">
          @for (g of [
            {key:'todos', label:'Todos'},
            {key:'nino',  label:'üë¶ Ni√±o'},
            {key:'nina',  label:'üëß Ni√±a'}
          ]; track g.key) {
            <button
              class="genero-btn"
              [class.active]="filtroGenero() === g.key"
              (click)="setGenero(g.key)"
            >{{ g.label }}</button>
          }
        </div>
      </div>
    }

    <!-- Talla (solo para Piolito) -->
    @if (filtroLinea() === 'piolito' && tallasDisponibles().length > 0) {
      <div class="filter-group">
        <h3 class="filter-title">Talla</h3>
        <div class="tallas-grid">
          @for (t of tallasDisponibles(); track t) {
            <button
              class="talla-btn"
              [class.active]="filtroTalla() === t"
              (click)="toggleTalla(t)"
            >{{ t }}</button>
          }
        </div>
      </div>
    }

    <!-- Limpiar -->
    @if (hayFiltrosActivos()) {
      <button class="btn-limpiar" (click)="limpiarFiltros()">
        ‚úï Limpiar filtros
      </button>
    }
  </aside>

  <!-- ‚îÄ‚îÄ CONTENT ‚îÄ‚îÄ -->
  <div class="catalog-content">

    <!-- Toolbar -->
    <div class="toolbar">
      <span class="result-count">
        <strong>{{ productosFiltrados().length }}</strong> modelo{{ productosFiltrados().length !== 1 ? 's' : '' }} encontrado{{ productosFiltrados().length !== 1 ? 's' : '' }}
      </span>
      <div class="view-toggle">
        <button class="view-btn" [class.active]="vistaGrid()"  (click)="vistaGrid.set(true)"  title="Vista grid">‚ñ¶</button>
        <button class="view-btn" [class.active]="!vistaGrid()" (click)="vistaGrid.set(false)" title="Vista lista">‚ò∞</button>
      </div>
    </div>

    <!-- Sin resultados -->
    @if (productosFiltrados().length === 0) {
      <div class="empty-state">
        <span class="empty-icon">üîç</span>
        <h3>No encontramos productos</h3>
        <p>Prueba con otros filtros o escr√≠benos para ayudarte.</p>
        <a [href]="(waBase + 'Hola!%20Busco%20un%20modelo%20espec√≠fico%20y%20no%20lo%20encuentro%20en%20el%20cat√°logo') | sanitizeUrl"
           class="btn-wa" target="_blank" rel="noopener">
          <svg viewBox="0 0 24 24"><path [attr.d]="waIcon"/></svg>
          Consultar por WhatsApp
        </a>
      </div>
    }

    <!-- GRID de productos -->
    @if (productosFiltrados().length > 0 && vistaGrid()) {
      <div class="products-grid">
        @for (p of productosFiltrados(); track p.id) {
          <div class="prod-card" (click)="abrirModal(p)">
            <div class="prod-img" [style.--line-color]="lineaColor(p.linea)">
              <img [src]="p.imagen" [alt]="p.codigo" class="prod-image" />
              <div class="prod-img-placeholder">
                <span class="prod-img-code">{{ p.codigo }}</span>
                <div class="prod-colors-preview">
                  @for (c of p.colores.slice(0,3); track c) {
                    <span class="color-swatch" [style.background]="c"></span>
                  }
                </div>
              </div>
              <div class="prod-badges">
                @if (p.nuevo) {
                  <span class="badge badge-new">Nuevo</span>
                }
                <span class="badge badge-season">{{ subcatLabel(p.subcategoria) }}</span>
              </div>
              <div class="prod-overlay">
                <span class="overlay-text">Ver detalle</span>
              </div>
            </div>
            <div class="prod-info">
              <div class="prod-meta">
                <span class="prod-linea" [style.color]="lineaColor(p.linea)">{{ lineaLabel(p.linea) }}</span>
                <span class="prod-genero">{{ generoLabel(p.genero) }}</span>
              </div>
              <h3 class="prod-codigo">{{ p.codigo }}</h3>
              <div class="prod-tallas-row">
                <span class="tallas-label">Tallas:</span>
                <span class="tallas-val">{{ p.tallas }}</span>
              </div>
              <div class="prod-colores">
                @for (c of p.colores; track c) {
                  <span class="color-dot" [style.background]="c" [title]="c"></span>
                }
              </div>
              <a
                [href]="(waBase + waTexto(p)) | sanitizeUrl"
                class="btn-wa-prod"
                target="_blank"
                rel="noopener"
                (click)="$event.stopPropagation()"
              >
                <svg viewBox="0 0 24 24"><path [attr.d]="waIcon"/></svg>
                Cotizar
              </a>
            </div>
          </div>
        }
      </div>
    }

    <!-- LISTA de productos -->
    @if (productosFiltrados().length > 0 && !vistaGrid()) {
      <div class="products-list">
        @for (p of productosFiltrados(); track p.id) {
          <div class="list-card" (click)="abrirModal(p)">
            <div class="list-img" [style.--line-color]="lineaColor(p.linea)">
              <img [src]="p.imagen" [alt]="p.codigo" class="prod-image" />
              <div class="prod-img-placeholder small">
                <span class="prod-img-code">{{ p.codigo }}</span>
              </div>
            </div>
            <div class="list-info">
              <div class="prod-meta">
                <span class="prod-linea" [style.color]="lineaColor(p.linea)">{{ lineaLabel(p.linea) }}</span>
                <span class="prod-genero">{{ generoLabel(p.genero) }}</span>
                @if (p.nuevo) { <span class="badge badge-new">Nuevo</span> }
                <span class="badge badge-season">{{ subcatLabel(p.subcategoria) }}</span>
              </div>
              <h3 class="prod-codigo">{{ p.codigo }}</h3>
              <p class="prod-desc-short">{{ p.descripcion }}</p>
              <div class="list-bottom">
                <span class="tallas-val">Tallas: <strong>{{ p.tallas }}</strong></span>
                <div class="prod-colores">
                  @for (c of p.colores; track c) {
                    <span class="color-dot" [style.background]="c"></span>
                  }
                </div>
              </div>
            </div>
            <a
              [href]="(waBase + waTexto(p)) | sanitizeUrl"
              class="btn-wa-list"
              target="_blank"
              rel="noopener"
              (click)="$event.stopPropagation()"
            >
              <svg viewBox="0 0 24 24"><path [attr.d]="waIcon"/></svg>
              Cotizar
            </a>
          </div>
        }
      </div>
    }
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODAL DETALLE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
@if (productoModal()) {
  <div class="modal-backdrop" (click)="cerrarModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <button class="modal-close" (click)="cerrarModal()">‚úï</button>
      <div class="modal-body">
        <div class="modal-img" [style.--line-color]="lineaColor(productoModal()!.linea)">
          <img [src]="productoModal()!.imagen" [alt]="productoModal()!.codigo" class="prod-image" />
          <div class="prod-img-placeholder large">
            <span class="prod-img-code">{{ productoModal()!.codigo }}</span>
            <div class="prod-colors-preview">
              @for (c of productoModal()!.colores; track c) {
                <span class="color-swatch lg" [style.background]="c"></span>
              }
            </div>
          </div>
          <div class="prod-badges modal-badges">
            @if (productoModal()!.nuevo) {
              <span class="badge badge-new">Nuevo</span>
            }
            <span class="badge badge-season">{{ subcatLabel(productoModal()!.subcategoria) }}</span>
          </div>
        </div>
        <div class="modal-detail">
          <span class="prod-linea lg" [style.color]="lineaColor(productoModal()!.linea)">
            {{ lineaLabel(productoModal()!.linea) }}
          </span>
          <h2 class="modal-title">{{ productoModal()!.codigo }}</h2>
          <span class="modal-genero">{{ generoLabel(productoModal()!.genero) }}</span>
          <p class="modal-desc">{{ productoModal()!.descripcion }}</p>
          <div class="modal-section">
            <span class="modal-label">Tallas disponibles</span>
            <div class="tallas-grid modal-tallas">
              @for (t of productoModal()!.tallasArray; track t) {
                <span class="talla-display">{{ t }}</span>
              }
            </div>
          </div>
          <div class="modal-section">
            <span class="modal-label">Colores disponibles</span>
            <div class="colores-row">
              @for (c of productoModal()!.colores; track c) {
                <span class="color-dot lg" [style.background]="c" [title]="c"></span>
              }
            </div>
          </div>
          <a
            [href]="(waBase + waTexto(productoModal()!)) | sanitizeUrl"
            class="btn-wa modal-wa"
            target="_blank" rel="noopener"
          >
            <svg viewBox="0 0 24 24"><path [attr.d]="waIcon"/></svg>
            Cotizar este modelo por WhatsApp
          </a>
          <p class="modal-note">
            üí¨ Nuestro equipo te responder√° con disponibilidad, tallas y precios.
          </p>
        </div>
      </div>
    </div>
  </div>
}

<!-- WA flotante -->
<a [href]="(waBase + 'Hola!%20Quiero%20ver%20el%20cat√°logo%20de%20Piolito') | sanitizeUrl"
   class="wa-float" target="_blank" rel="noopener" title="Cotizar por WhatsApp">
  <svg viewBox="0 0 24 24"><path [attr.d]="waIcon"/></svg>
</a>